該說明文件主要在講述系統的淨資產計算與不同貨幣間的轉換是怎麼運作的

# Okane 錢包系統完整設計文件

## 1. 系統概述

### 1.1 系統目標
Okane 是一個多幣別資產管理系統，專為需要管理多種貨幣和資產的用戶設計，提供：
- 精確的淨資產計算
- 靈活的多幣別管理
- 智能的成本追蹤
- 即時的匯率轉換

### 1.2 核心價值
- **準確性**: 精確計算各種資產的成本和價值
- **靈活性**: 支援多種貨幣和資產類型
- **即時性**: 提供即時匯率和資產價值更新
- **易用性**: 直觀的用戶界面和操作流程

## 2. 功能需求規格

### 2.1 用戶管理
- **用戶註冊/登入**: 支援 Email、密碼、雙因素認證
- **個人設定**: 主貨幣設定、語言偏好、通知設定
- **資料備份**: 自動備份和手動匯出功能

### 2.2 錢包管理
- **錢包建立**: 支援多種錢包類型（手動、同步、混合）
- **錢包設定**: 名稱、顏色、初始餘額、主要/次要貨幣
- **錢包分類**: 現金、加密貨幣、股票、其他資產

### 2.3 交易管理
- **交易記錄**: 收入、支出、轉帳、資產買賣
- **交易分類**: 自定義分類標籤
- **批次操作**: 批次匯入、批次編輯、批次刪除

## 3. 淨資產計算系統

### 3.1 計算邏輯
淨資產計算是通過將所有資產的價值加總，然後減去所有負債的價值來完成的。這個計算可以幫助用戶了解他們的財務狀況。

**計算公式**:
```
淨資產 = Σ(資產價值) - Σ(負債價值)
```

### 3.2 主貨幣設定
- 淨資產旁邊需加註該淨資產是用什麼貨幣作為基準進行計算
- 提供快速切換主貨幣的按鈕
- 在用戶個人設定中設定預設「主貨幣」

### 3.3 多幣別資產處理
- 支援同一錢包內多種貨幣共存
- 自動將非主貨幣資產轉換為主貨幣計算
- 顯示原始貨幣金額和轉換後金額

## 4. 貨幣轉換系統

### 4.1 匯率來源
- **即時匯率**: 透過外部 API 獲取最新匯率（如國泰API）
- **歷史匯率**: 記錄特定時間點的匯率資料
- **手動匯率**: 允許用戶手動設定特定匯率

### 4.2 匯率管理
- **購買時匯率記錄**: 記錄資產購買時的匯率
- **成本價計算**: 使用購買時匯率計算成本
- **即時價值計算**: 使用當前匯率計算現值
- **匯率變動追蹤**: 顯示匯率變動對資產價值的影響

### 4.3 匯率更新策略
- **自動更新**: 每小時/每日自動更新匯率
- **手動更新**: 用戶可手動觸發匯率更新
- **離線模式**: 網路不可用時使用最後更新的匯率

## 5. 成本追蹤系統

### 5.1 成本計算方法
- **先進先出 (FIFO)**: 預設使用先進先出法
- **加權平均成本**: 支援加權平均成本計算
- **指定批次**: 允許用戶指定特定批次賣出

### 5.2 平均成本計算
- **同幣別平均**: 相同貨幣資產的平均成本
- **跨幣別平均**: 轉換為主貨幣後的平均成本
- **時間加權**: 考慮持有時間的加權平均

### 5.3 損益計算
- **未實現損益**: 當前價值與成本價的差額
- **已實現損益**: 實際交易產生的損益
- **總損益**: 未實現 + 已實現損益

## 6. 舉例情況

使用者設定中的主貨幣為「新台幣 TWD」

### 6.1 錢包資料範例
- **7/4 轉帳 -1000 TWD**: （貸款暫存）
- **7/5 資產 50 USDT**: 成本：1：30.5 -> NTD$1525
- **7/6 資產 100 USDT**: 成本：1：29.8 -> NTD$2980

### 6.2 計算結果
- **USDT 總量**: 150 USDT
- **USDT 平均成本**: (1525 + 2980) / 150 = 30.03 TWD/USDT
- **當前 USDT 價值**: 150 × 31.2 = 4,680 TWD (假設當前匯率 1:31.2)
- **淨資產**: 4,680 - 1,000 = 3,680 TWD

## 7. 錢包設計架構

### 7.1 錢包核心功能
- **設定幣別**: 支援多種貨幣設定
- **錢包內容**: 包含資產和交易明細
- **資產管理**: 加入、支出、轉帳等操作
- **自動同步**: 與銀行/交易所 API 同步（未來功能）

### 7.2 資產類型分類
- **加密貨幣**: BTC, ETH, USDT, USDC 等
- **法幣現金**: TWD, USD, JPY, EUR 等
- **股票基金**: 台股、美股、ETF 等
- **其他資產**: 貴金屬、房地產等

### 7.3 錢包餘額顯示
- **主要顯示**: 資產總額（主貨幣）：**TWD $ 3,680**
- **詳細顯示**: 各幣別分別數量：**USDT $ 150 + TWD $ -1,000**
- **趨勢圖表**: 顯示資產價值變化趨勢

## 8. 用戶界面設計

### 8.1 主要介面元素
- **資產總覽**: 清晰的淨資產顯示
- **錢包列表**: 各錢包的快速概覽
- **交易記錄**: 詳細的交易歷史
- **統計圖表**: 資產分佈和趨勢分析

### 8.2 操作流程
- **快速記帳**: 簡化的收支記錄流程
- **批次操作**: 支援多筆交易同時處理
- **智能分類**: 自動分類建議
- **搜尋篩選**: 強大的交易搜尋功能

### 8.3 用戶體驗優化
- **直觀導航**: 清晰的頁面結構
- **快速操作**: 常用功能快捷鍵
- **視覺回饋**: 操作狀態即時提示
- **多語言**: 中文界面優先，支援其他語言

## 9. 技術架構

### 9.1 前端架構
- **框架**: React + Vite
- **狀態管理**: 使用 Context API 或 Redux
- **UI 組件**: 自定義組件庫
- **圖表庫**: Chart.js 或 D3.js

### 9.2 後端架構
- **框架**: NestJS + TypeScript
- **資料庫**: PostgreSQL
- **ORM**: TypeORM
- **認證**: JWT + 雙因素認證

### 9.3 匯率服務
- **即時匯率**: 整合多個匯率 API
- **容錯機制**: 多個備用 API 源
- **快取策略**: Redis 快取匯率資料
- **更新頻率**: 可配置的更新間隔

---

這個設計系統旨在為用戶提供一個全面、安全、高效的資產管理解決方案，特別適合需要管理多種貨幣和資產的用戶。通過精確的計算、靈活的配置和直觀的操作，幫助用戶更好地管理和追蹤他們的財務狀況。